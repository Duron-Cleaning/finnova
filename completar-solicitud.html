<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Completar Solicitud - FINNOVA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        h1 {
            color: #6a1b9a;
            text-align: center;
            margin-bottom: 30px;
        }

        .form-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-section {
            margin-bottom: 20px;
        }

        .form-section h3 {
            color: #333;
            font-size: 16px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        /* Remover flechas de campos numéricos */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        .file-input-container {
            margin-bottom: 10px;
        }

        .file-input-container label {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }

        .file-input-button {
            display: inline-block;
            padding: 8px 12px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .file-input-button:hover {
            background-color: #e0e0e0;
        }

        .file-name {
            margin-left: 10px;
            color: #666;
            font-size: 14px;
        }

        .submit-button {
            width: 100%;
            padding: 15px;
            background-color: #6a1b9a;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        .submit-button:hover {
            background-color: #581b7b;
        }

        .submit-button.active-button {
            background-color: #6a1b9a;
            color: white;
            cursor: pointer;
            opacity: 1;
        }

        .submit-button.active-button:hover {
            background-color: #4a148c;
        }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 12px;
            padding-right: 24px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        /* Estilos para los tooltips de ayuda */
        .input-group {
            position: relative;
            margin-bottom: 15px;
        }

        .input-label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 14px;
        }

        .input-help {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
            font-style: italic;
        }

        /* Estilos para el mensaje */
        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 5px;
            color: white;
            font-weight: 500;
            display: none;
            z-index: 1000;
            animation: slideDown 0.5s ease-out;
        }

        .success {
            background-color: #4CAF50;
        }

        .error {
            background-color: #f44336;
        }

        @keyframes slideDown {
            from {
                top: -100px;
                opacity: 0;
            }
            to {
                top: 20px;
                opacity: 1;
            }
        }

        .submit-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .signature-container {
            width: 100%;
            margin: 15px 0;
        }

        #signatureCanvas {
            width: 100%;
            height: 200px;
            border: 2px solid #6a1b9a;
            border-radius: 8px;
            touch-action: none;
            background-color: #fff;
        }

        .signature-buttons {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-clear {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background-color: #e0e0e0;
            color: #333;
            cursor: pointer;
            font-size: 14px;
        }

        .signature-instructions {
            text-align: center;
            margin: 10px 0;
            color: #666;
            font-size: 14px;
        }

        .phone-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .phone-input-container input {
            flex: 1;
        }

        .send-code-button, .verify-button {
            padding: 8px 16px;
            background-color: #6a1b9a;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .send-code-button:hover, .verify-button:hover {
            background-color: #4a148c;
        }

        .send-code-button:disabled, .verify-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .verification-container {
            display: none;
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #f8f9fa;
        }

        .code-instructions {
            text-align: center;
            margin-bottom: 15px;
            color: #666;
        }

        .code-input-container {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .code-input {
            width: 45px;
            height: 45px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            border: 2px solid #6a1b9a;
            border-radius: 8px;
            background: white;
        }

        .code-input:focus {
            outline: none;
            border-color: #4a148c;
            box-shadow: 0 0 0 2px rgba(106, 27, 154, 0.2);
        }

        .verification-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }

        .resend-button {
            background: none;
            border: none;
            color: #6a1b9a;
            cursor: pointer;
            font-size: 14px;
        }

        .resend-button:disabled {
            color: #999;
            cursor: not-allowed;
        }

        .verification-message {
            margin-top: 10px;
            text-align: center;
            font-size: 14px;
        }

        .verification-message.success {
            color: #28a745;
        }

        .verification-message.error {
            color: #dc3545;
        }

        .sms-instructions {
            text-align: center;
            margin: 10px 0;
            color: #666;
            font-size: 14px;
        }

        .test-code {
            font-weight: bold;
            color: #6a1b9a;
            background: #f3e5f5;
            padding: 2px 8px;
            border-radius: 4px;
            margin: 0 4px;
        }

        .document-group {
            margin-bottom: 20px;
        }

        .document-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .file-input-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 2;
        }

        .file-name {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f8f9fa;
            color: #666;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-input-container::after {
            content: "Seleccionar archivo";
            position: absolute;
            right: 0;
            padding: 8px 16px;
            background-color: #6a1b9a;
            color: white;
            border-radius: 0 4px 4px 0;
            pointer-events: none;
        }

        .file-input-container:hover::after {
            background-color: #4a148c;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #6a1b9a;
            box-shadow: 0 0 0 2px rgba(106, 27, 154, 0.2);
        }

        .currency-input {
            position: relative;
            display: flex;
            align-items: center;
        }

        .currency-symbol {
            position: absolute;
            left: 12px;
            color: #666;
        }

        .currency-input input {
            padding-left: 30px;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23666' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 32px;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>Completa tu Solicitud</h1>
        
        <form id="loanForm" onsubmit="return validateAndSubmit(event)">
            <!-- Información Personal -->
            <div class="form-section">
                <h3>Información Personal</h3>
                
                <div class="input-group">
                    <label for="fullName">Nombre Completo</label>
                    <input type="text" id="fullName" name="fullName" required
                           placeholder="Ingrese su nombre completo">
                </div>

                <div class="input-group">
                    <label for="identityNumber">Número de Identidad</label>
                    <input type="text" id="identityNumber" name="identityNumber" required
                           placeholder="Ingrese su número de identidad"
                           pattern="[0-9]{13}"
                           title="Ingrese un número de identidad válido de 13 dígitos">
                </div>

                <div class="input-group">
                    <label for="gender">Género</label>
                    <select id="gender" name="gender" required>
                        <option value="">Seleccione su género</option>
                        <option value="M">Masculino</option>
                        <option value="F">Femenino</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="monthlyIncome">Ingreso Mensual</label>
                    <div class="currency-input">
                        <span class="currency-symbol">L.</span>
                        <input type="number" id="monthlyIncome" name="monthlyIncome" required
                               min="0" step="100"
                               placeholder="Ingrese su ingreso mensual">
                    </div>
                </div>
            </div>

            <!-- Información Laboral -->
            <div class="form-section">
                <h3>Información Laboral</h3>
                <input type="number" name="employmentTime" placeholder="Años de Empleo" required>
                <select name="employmentType" required>
                    <option value="">Tipo de Empleo</option>
                    <option value="permanent">Permanente</option>
                    <option value="contract">Contrato</option>
                    <option value="business_owner">Negocio Propio</option>
                    <option value="freelance">Freelance</option>
                </select>
            </div>

            <!-- Historial Crediticio -->
            <div class="form-section">
                <h3>Historial Crediticio</h3>
                
                <div class="input-group">
                    <label class="input-label">Pagos Tardíos (últimos 12 meses)</label>
                    <input type="text" name="latePayments" 
                           placeholder="Ejemplo: 2" 
                           pattern="[0-9]*"
                           oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                           inputmode="numeric">
                    <div class="input-help">Ingrese el número de veces que se ha atrasado en pagos de préstamos o tarjetas en el último año</div>
                </div>

                <div class="input-group">
                    <label class="input-label">Préstamos en Mora</label>
                    <input type="text" name="defaultedLoans" 
                           placeholder="Ejemplo: 0" 
                           pattern="[0-9]*"
                           oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                           inputmode="numeric">
                    <div class="input-help">Ingrese el número de préstamos que actualmente tiene en mora (más de 90 días de atraso)</div>
                </div>

                <div class="input-group">
                    <label class="input-label">Deudas Actuales (L)</label>
                    <input type="text" name="currentDebts" 
                           placeholder="Ejemplo: 25,000" 
                           pattern="[0-9,]*"
                           oninput="this.value = this.value.replace(/[^0-9,]/g, '');"
                           inputmode="numeric">
                    <div class="input-help">Ingrese el monto total de todas sus deudas actuales (préstamos, tarjetas, etc.)</div>
                </div>
            </div>

            <!-- Documentos Requeridos -->
            <div class="form-section">
                <h3>Documentos Requeridos</h3>
                
                <div class="document-group">
                    <label for="identidadDoc">Documento de Identidad</label>
                    <div class="file-input-container">
                        <input type="file" id="identidadDoc" class="file-input" required>
                        <div class="file-name" id="identidadDoc-name">Sin archivos seleccionados</div>
                    </div>
                </div>

                <div class="document-group">
                    <label for="incomesDoc">Comprobante de Ingresos</label>
                    <div class="file-input-container">
                        <input type="file" id="incomesDoc" class="file-input" required>
                        <div class="file-name" id="incomesDoc-name">Sin archivos seleccionados</div>
                    </div>
                </div>

                <div class="document-group">
                    <label for="employmentDoc">Constancia de Trabajo</label>
                    <div class="file-input-container">
                        <input type="file" id="employmentDoc" class="file-input" required>
                        <div class="file-name" id="employmentDoc-name">Sin archivos seleccionados</div>
                    </div>
                </div>

                <div class="document-group">
                    <label for="energyDoc">Recibo de Energía</label>
                    <div class="file-input-container">
                        <input type="file" id="energyDoc" class="file-input" required>
                        <div class="file-name" id="energyDoc-name">Sin archivos seleccionados</div>
                    </div>
                </div>
            </div>

            <!-- Firma Digital -->
            <div class="form-section">
                <h3>Firma Digital</h3>
                <p class="signature-instructions">Por favor, firma en el espacio de abajo para completar tu solicitud</p>
                <div class="signature-container">
                    <canvas id="signatureCanvas"></canvas>
                    <div class="signature-buttons">
                        <button type="button" class="btn-clear" id="clearButton">Borrar Firma</button>
                    </div>
                </div>
            </div>

            <!-- Verificación SMS -->
            <div class="form-section">
                <h3>Verificación por SMS</h3>
                <p class="sms-instructions">Para verificar tu identidad, te enviaremos un código por SMS</p>
                
                <div class="phone-input-container">
                    <input type="tel" id="phoneNumber" 
                           placeholder="Ingresa tu número celular" 
                           pattern="[0-9]{8}" 
                           maxlength="8"
                           required>
                    <button type="button" class="send-code-button" id="sendCodeButton">
                        Enviar Código
                    </button>
                </div>

                <div id="verificationContainer" class="verification-container">
                    <p class="code-instructions">
                        Código de prueba: <span id="testCode" class="test-code"></span><br>
                        Ingresa el código de 4 dígitos enviado a tu celular:
                    </p>
                    <div class="code-input-container">
                        <input type="text" class="code-input" maxlength="1" pattern="[0-9]" inputmode="numeric">
                        <input type="text" class="code-input" maxlength="1" pattern="[0-9]" inputmode="numeric">
                        <input type="text" class="code-input" maxlength="1" pattern="[0-9]" inputmode="numeric">
                        <input type="text" class="code-input" maxlength="1" pattern="[0-9]" inputmode="numeric">
                    </div>
                    <div class="verification-actions">
                        <button type="button" class="verify-button" id="verifyCodeButton" disabled>
                            Verificar Código
                        </button>
                        <button type="button" class="resend-button" id="resendCodeButton" disabled>
                            Reenviar Código (<span id="resendTimer">60</span>s)
                        </button>
                    </div>
                    <div id="verificationMessage" class="verification-message"></div>
                </div>
            </div>

            <!-- Botón de envío siempre habilitado con estilo activo -->
            <button type="submit" class="submit-button active-button">Enviar Solicitud</button>
        </form>
    </div>

    <div id="message" class="message"></div>

    <script src="js/firma-digital.js"></script>
    <script src="js/verificacion-sms.js"></script>
    <script>
        // Asegurarse de que el botón siempre esté habilitado y con estilo activo
        const submitButton = document.querySelector('.submit-button');
        submitButton.disabled = false;
        submitButton.classList.add('active-button');

        // Manejar la visualización del nombre de archivo seleccionado
        const fileInputs = ['identidadDoc', 'incomesDoc', 'employmentDoc', 'energyDoc'];
        
        fileInputs.forEach(inputId => {
            document.getElementById(inputId).addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name || 'Sin archivos seleccionados';
                document.getElementById(inputId + '-name').textContent = fileName;
            });
        });

        // Función para mostrar mensajes
        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';

            setTimeout(() => {
                message.style.display = 'none';
            }, 5000);
        }

        // Función para manejar el envío del formulario
        function validateAndSubmit(event) {
            event.preventDefault();
            
            // Obtener todos los campos requeridos
            const form = document.getElementById('loanForm');
            const requiredInputs = form.querySelectorAll('input[required], select[required]');
            const emptyInputs = Array.from(requiredInputs).filter(input => !input.value.trim());

            if (emptyInputs.length > 0) {
                showMessage('Por favor complete todos los campos requeridos', 'error');
                return false;
            }

            // Si todo está bien, mostrar mensaje de éxito y redirigir
            showMessage('¡Solicitud enviada exitosamente! Nos pondremos en contacto contigo pronto.', 'success');
            
            setTimeout(() => {
                window.location.href = 'solicitud-confirmacion.html';
            }, 3000);

            return false;
        }
    </script>
</body>
</html>
